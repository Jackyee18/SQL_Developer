WITH A AS(
SELECT 
    SYM_RUN_DATE AS REPORTING_DATE, MACN AS BRANCH_NO, BUSINESS_LINE, 
    MAX('N' || TO_CHAR(MTK_DINHLUONG)) AS TYPE, -- Use MAX or another appropriate aggregate function
    SUM(DUNO_QD) AS DUNO_QD
FROM BCQT_CHOVAY
WHERE MTK_DINHLUONG IN (1, 2)
GROUP BY SYM_RUN_DATE, MACN, BUSINESS_LINE
UNION ALL
SELECT 
    SYM_RUN_DATE AS REPORTING_DATE, MACN AS BRANCH_NO, BUSINESS_LINE, 
    'N345' AS TYPE, SUM(DUNO_QD) AS DUNO_QD
FROM BCQT_CHOVAY
WHERE MTK_DINHLUONG IN (3,4,5)
GROUP BY SYM_RUN_DATE, MACN, BUSINESS_LINE)
SELECT 
    REPORTING_DATE, BRANCH_NO, BUSINESS_LINE, TYPE,
    EXTRACT(YEAR FROM REPORTING_DATE) AS YEAR,
    EXTRACT(MONTH FROM REPORTING_DATE) AS MONTH,
    EXTRACT(DAY FROM REPORTING_DATE) AS DAY,
    DUNO_QD/1000000000 AS DUNO_QD
FROM A
